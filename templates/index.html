<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API de Videojuegos</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
        /* Estilos para la navegaci√≥n simple */
        .simple-nav {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 0 auto 30px;
            padding: 12px;
            background-color: var(--color-dark-gray);
            border-radius: 6px;
            border: 2px solid var(--color-lighter-gray);
            max-width: 800px;
        }
        
        .simple-nav a {
            color: var(--color-light);
            text-decoration: none;
            font-size: 1.1rem;
            padding: 8px 20px;
            border-radius: 4px;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        
        .simple-nav a:hover {
            background-color: var(--color-gray);
            color: var(--color-primary);
            transform: translateY(-2px);
        }
        
        .simple-nav a.active {
            background-color: var(--color-primary);
            color: var(--color-dark);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        /* Estilos para selects m√∫ltiples */
        .select-dropdown {
            width: 100%;
            padding: 10px;
            background-color: var(--color-light-gray);
            border: 2px solid var(--color-lighter-gray);
            color: var(--color-light);
            border-radius: 4px;
            margin-bottom: 10px;
        }

        /* Estilos para items */
        .minecraft-item {
            background-color: var(--color-light-gray);
            border-left: 5px solid var(--color-primary);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 4px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .item-info {
            flex: 1;
            min-width: 200px;
        }

        .compatibilidad-tag {
            background-color: var(--color-lighter-gray);
            padding: 2px 5px;
            border-radius: 3px;
            margin-right: 5px;
        }

        .item-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        /* Estilos para formularios de edici√≥n */
        .editar-form {
            background-color: var(--color-gray);
            padding: 20px;
            margin-top: 15px;
            border-radius: 6px;
            display: none;
        }

        /* Estilos para b√∫squeda */
        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
    </style>
</head>
<body>
    <div class="minecraft-container">
        <h1 class="minecraft-title">API de Videojuegos</h1>
        
        <!-- Barra de navegaci√≥n simple -->
        <div class="simple-nav">
            <a href="/" class="active">Inicio</a>
            <a href="/comparaciones">Comparaciones</a>
            <a href="/historial?clave=8080">Historial</a>
        </div>

        <!-- Secci√≥n de Juegos -->
        <div id="juegos-section" class="minecraft-section" style="display:none;">
            <h2>‚ú® A√±adir Nuevo Juego</h2>
            <form id="juego-form" class="minecraft-form" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="nombre-juego">Nombre:</label>
                    <input type="text" id="nombre-juego" name="nombre" required class="minecraft-input">
                </div>
                
                <div class="form-group">
                    <label for="genero-juego">G√©nero:</label>
                    <input type="text" id="genero-juego" name="genero" required class="minecraft-input">
                </div>
                
                <div class="form-group">
                    <label for="a√±o-juego">A√±o:</label>
                    <input type="number" id="a√±o-juego" name="a√±o" class="minecraft-input">
                </div>
                
                <div class="form-group">
                    <label for="desarrollador-juego">Desarrollador:</label>
                    <input type="text" id="desarrollador-juego" name="desarrollador" required class="minecraft-input">
                </div>
                
                <div class="form-group">
                    <label>Consolas compatibles:</label>
                    <select id="consolas-select" multiple class="select-dropdown">
                        {% for consola in consolas %}
                        <option value="{{ consola.id }}">{{ consola.nombre }} ({{ consola.fabricante }})</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Accesorios compatibles:</label>
                    <select id="accesorios-select" multiple class="select-dropdown">
                        {% for accesorio in accesorios %}
                        <option value="{{ accesorio.id }}">{{ accesorio.nombre }} ({{ accesorio.tipo }})</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="imagen-juego">Imagen:</label>
                    <input type="file" id="imagen-juego" name="imagen" accept="image/*" class="minecraft-input">
                </div>
                
                <button type="submit" class="minecraft-button">Crear Juego</button>
            </form>

            <h2>üìú Tus Juegos</h2>
            <div id="juegos-list">
                {% for juego in juegos %}
                <div class="minecraft-item" id="juego-{{ juego.id }}">
                    {% if juego.imagen %}
                    <img src="{{ juego.imagen }}" alt="{{ juego.nombre }}" class="minecraft-img">
                    {% endif %}
                    <div class="item-info">
                        <h3>{{ juego.nombre }}</h3>
                        <p><strong>G√©nero:</strong> {{ juego.genero }}</p>
                        {% if juego.a√±o %}<p><strong>A√±o:</strong> {{ juego.a√±o }}</p>{% endif %}
                        <p><strong>Desarrollador:</strong> {{ juego.desarrollador }}</p>
                        
                        {% if juego.consolas %}
                        <p><strong>Consolas:</strong> 
                            {% for consola in juego.consolas %}
                            <span class="compatibilidad-tag">{{ consola.nombre }}</span>
                            {% endfor %}
                        </p>
                        {% endif %}
                    </div>
                    <div class="item-actions">
                        <button onclick="mostrarEditarJuego({{ juego.id }})" class="minecraft-button">Editar</button>
                        <button onclick="eliminarJuego({{ juego.id }})" class="minecraft-button">Eliminar</button>
                    </div>
                </div>

                <div id="editar-juego-{{ juego.id }}" class="editar-form">
                    <h3>Editar Juego</h3>
                    <form class="minecraft-form" onsubmit="actualizarJuego(event, {{ juego.id }})" enctype="multipart/form-data">
                        <input type="hidden" name="juego_id" value="{{ juego.id }}">
                        
                        <div class="form-group">
                            <label for="editar-nombre-{{ juego.id }}">Nombre:</label>
                            <input type="text" id="editar-nombre-{{ juego.id }}" name="nombre" value="{{ juego.nombre }}" required class="minecraft-input">
                        </div>
                        
                        <div class="form-group">
                            <label for="editar-genero-{{ juego.id }}">G√©nero:</label>
                            <input type="text" id="editar-genero-{{ juego.id }}" name="genero" value="{{ juego.genero }}" required class="minecraft-input">
                        </div>
                        
                        <div class="form-group">
                            <label for="editar-a√±o-{{ juego.id }}">A√±o:</label>
                            <input type="number" id="editar-a√±o-{{ juego.id }}" name="a√±o" value="{{ juego.a√±o }}" class="minecraft-input">
                        </div>
                        
                        <div class="form-group">
                            <label for="editar-desarrollador-{{ juego.id }}">Desarrollador:</label>
                            <input type="text" id="editar-desarrollador-{{ juego.id }}" name="desarrollador" value="{{ juego.desarrollador }}" required class="minecraft-input">
                        </div>
                        
                        <button type="submit" class="minecraft-button">Guardar Cambios</button>
                        <button type="button" onclick="ocultarEditarJuego({{ juego.id }})" class="minecraft-button">Cancelar</button>
                    </form>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Secci√≥n de B√∫squeda (visible por defecto) -->
        <div id="busqueda-section" class="minecraft-section">
            <h2>üîç Buscar en el Cat√°logo</h2>
            
            <div class="search-box">
                <input type="text" id="search-query" placeholder="Buscar por nombre, g√©nero, a√±o..." class="minecraft-input">
                <select id="search-type" class="minecraft-input">
                    <option value="todo">Todo</option>
                    <option value="juegos">Juegos</option>
                    <option value="consolas">Consolas</option>
                    <option value="accesorios">Accesorios</option>
                </select>
                <button onclick="buscarRapida()" class="minecraft-button">Buscar</button>
            </div>
            
            <div id="search-results" class="search-results">
                <!-- Los resultados se mostrar√°n aqu√≠ -->
            </div>
        </div>
    </div>

    <script>
        // Mostrar secci√≥n de b√∫squeda al cargar
        document.addEventListener('DOMContentLoaded', function() {
            // Ocultar todas las secciones excepto b√∫squeda
            document.querySelectorAll('.minecraft-section').forEach(section => {
                section.style.display = 'none';
            });
            document.getElementById('busqueda-section').style.display = 'block';
            
            // Manejar clics en la navegaci√≥n
            document.querySelectorAll('.simple-nav a').forEach(link => {
                link.addEventListener('click', function(e) {
                    if(this.getAttribute('href') === '/') {
                        e.preventDefault();
                        document.querySelectorAll('.minecraft-section').forEach(s => {
                            s.style.display = 'none';
                        });
                        document.getElementById('busqueda-section').style.display = 'block';
                    }
                    
                    // Actualizar estado activo
                    document.querySelectorAll('.simple-nav a').forEach(a => {
                        a.classList.remove('active');
                    });
                    this.classList.add('active');
                });
            });
        });

        // Funciones para juegos
        function mostrarEditarJuego(id) {
            document.getElementById(`editar-juego-${id}`).style.display = 'block';
        }

        function ocultarEditarJuego(id) {
            document.getElementById(`editar-juego-${id}`).style.display = 'none';
        }

        async function actualizarJuego(e, id) {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            try {
                const response = await fetch(`/api/juegos/${id}`, {
                    method: 'PUT',
                    body: formData
                });
                
                if (response.ok) {
                    alert('Juego actualizado con √©xito!');
                    location.reload();
                } else {
                    const error = await response.json();
                    throw new Error(error.detail || 'Error desconocido');
                }
            } catch (error) {
                alert('Error al actualizar juego: ' + error.message);
            }
        }

        async function eliminarJuego(id) {
            if (!confirm('¬øEst√°s seguro de eliminar este juego?')) return;
            
            try {
                const response = await fetch(`/api/juegos/${id}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    alert('Juego eliminado con √©xito!');
                    location.reload();
                }
            } catch (error) {
                alert('Error al eliminar juego: ' + error.message);
            }
        }

        // Funci√≥n de b√∫squeda
        async function buscarRapida() {
            const query = document.getElementById('search-query').value.trim();
            const tipo = document.getElementById('search-type').value;
            
            if (!query) {
                alert('Por favor ingresa un t√©rmino de b√∫squeda');
                return;
            }
            
            try {
                const response = await fetch(`/api/buscar?q=${encodeURIComponent(query)}&tipo=${tipo}`);
                const resultados = await response.json();
                
                mostrarResultados(resultados);
            } catch (error) {
                alert('Error al buscar: ' + error.message);
            }
        }

        function mostrarResultados(resultados) {
            const container = document.getElementById('search-results');
            container.innerHTML = '';
            
            if (!resultados || Object.keys(resultados).length === 0) {
                container.innerHTML = '<p>No se encontraron resultados</p>';
                return;
            }
            
            for (const [tipo, items] of Object.entries(resultados)) {
                if (!items || items.length === 0) continue;
                
                const section = document.createElement('div');
                section.className = 'result-section';
                section.innerHTML = `<h3>${tipo.charAt(0).toUpperCase() + tipo.slice(1)}</h3>`;
                
                items.forEach(item => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'minecraft-item';
                    
                    let html = `<h4>${item.nombre}</h4>`;
                    if (item.genero) html += `<p><strong>G√©nero:</strong> ${item.genero}</p>`;
                    if (item.a√±o) html += `<p><strong>A√±o:</strong> ${item.a√±o}</p>`;
                    if (item.desarrollador) html += `<p><strong>Desarrollador:</strong> ${item.desarrollador}</p>`;
                    if (item.imagen) html += `<img src="${item.imagen}" alt="${item.nombre}" class="minecraft-img">`;
                    
                    itemElement.innerHTML = html;
                    section.appendChild(itemElement);
                });
                
                container.appendChild(section);
            }
        }
    </script>
</body>
</html>