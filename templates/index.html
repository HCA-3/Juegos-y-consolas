<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Minecraft de Videojuegos</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
        @font-face {
            font-family: 'Minecraft';
            src: url('https://fonts.cdnfonts.com/css/minecraft-4');
        }
        body {
            font-family: 'Minecraft', sans-serif;
        }
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 5px;
        }
        .minecraft-checkbox {
            background-color: var(--color-light-gray);
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
        }
        .minecraft-checkbox input {
            margin-right: 5px;
        }
        .select-dropdown {
            width: 100%;
            padding: 10px;
            background-color: var(--color-light-gray);
            border: 2px solid var(--color-lighter-gray);
            color: var(--color-light);
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .editar-form {
            background-color: var(--color-gray);
            padding: 20px;
            margin-top: 15px;
            border-radius: 6px;
        }
        .item-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="minecraft-container">
        <h1 class="minecraft-title">API de Videojuegos (Minecraft Style)</h1>
        
        <!-- Navegaci√≥n -->
        <div class="minecraft-nav">
            <button onclick="mostrarSeccion('juegos')" class="minecraft-nav-btn">üéÆ Juegos</button>
            <button onclick="mostrarSeccion('consolas')" class="minecraft-nav-btn">üïπÔ∏è Consolas</button>
            <button onclick="mostrarSeccion('accesorios')" class="minecraft-nav-btn">üéß Accesorios</button>
            <button onclick="mostrarSeccion('busqueda')" class="minecraft-nav-btn">üîç Buscar</button>
        </div>

        <!-- Secci√≥n de Juegos -->
        <div id="juegos-section" class="minecraft-section" style="display:none;">
            <h2>‚ú® A√±adir Nuevo Juego:</h2>
            <form id="juego-form" class="minecraft-form" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="nombre-juego">Nombre:</label>
                    <input type="text" id="nombre-juego" name="nombre" required class="minecraft-input">
                </div>
                
                <div class="form-group">
                    <label for="genero-juego">G√©nero:</label>
                    <input type="text" id="genero-juego" name="genero" required class="minecraft-input">
                </div>
                
                <div class="form-group">
                    <label for="a√±o-juego">A√±o:</label>
                    <input type="number" id="a√±o-juego" name="a√±o" class="minecraft-input">
                </div>
                
                <div class="form-group">
                    <label for="desarrollador-juego">Desarrollador:</label>
                    <input type="text" id="desarrollador-juego" name="desarrollador" required class="minecraft-input">
                </div>
                
                <div class="form-group">
                    <label>Consolas compatibles:</label>
                    <select id="consolas-select" multiple class="select-dropdown">
                        {% for consola in consolas %}
                        <option value="{{ consola.id }}">{{ consola.nombre }} ({{ consola.fabricante }})</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Accesorios compatibles:</label>
                    <select id="accesorios-select" multiple class="select-dropdown">
                        {% for accesorio in accesorios %}
                        <option value="{{ accesorio.id }}">{{ accesorio.nombre }} ({{ accesorio.tipo }})</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="imagen-juego">Imagen:</label>
                    <input type="file" id="imagen-juego" name="imagen" accept="image/*" class="minecraft-input">
                </div>
                
                <button type="submit" class="minecraft-button">‚õèÔ∏è Crear Juego</button>
            </form>

            <h2>üìú Tus Juegos:</h2>
            <div id="juegos-list">
                {% for juego in juegos %}
                <div class="minecraft-item" id="juego-{{ juego.id }}">
                    {% if juego.imagen %}
                    <img src="{{ juego.imagen }}" alt="{{ juego.nombre }}" class="minecraft-img">
                    {% endif %}
                    <div class="item-info">
                        <h3>{{ juego.nombre }}</h3>
                        <p><strong>G√©nero:</strong> {{ juego.genero }}</p>
                        {% if juego.a√±o %}<p><strong>A√±o:</strong> {{ juego.a√±o }}</p>{% endif %}
                        <p><strong>Desarrollador:</strong> {{ juego.desarrollador }}</p>
                        
                        {% if juego.consolas %}
                        <p><strong>Consolas:</strong> 
                            {% for consola in juego.consolas %}
                            <span class="compatibilidad-tag">{{ consola.nombre }}</span>
                            {% endfor %}
                        </p>
                        {% endif %}
                        
                        {% if juego.accesorios %}
                        <p><strong>Accesorios:</strong> 
                            {% for accesorio in juego.accesorios %}
                            <span class="compatibilidad-tag">{{ accesorio.nombre }}</span>
                            {% endfor %}
                        </p>
                        {% endif %}
                    </div>
                    <div class="item-actions">
                        <button onclick="mostrarEditarJuego({{ juego.id }})" class="minecraft-button">‚úèÔ∏è Editar</button>
                        <button onclick="eliminarJuego({{ juego.id }})" class="minecraft-button">üóëÔ∏è Eliminar</button>
                    </div>
                </div>

                <!-- Formulario de edici√≥n (oculto inicialmente) -->
                <div id="editar-juego-{{ juego.id }}" class="editar-form" style="display:none;">
                    <h3>‚úèÔ∏è Editar Juego</h3>
                    <form class="minecraft-form" onsubmit="actualizarJuego(event, {{ juego.id }})" enctype="multipart/form-data">
                        <input type="hidden" name="juego_id" value="{{ juego.id }}">
                        
                        <div class="form-group">
                            <label for="editar-nombre-{{ juego.id }}">Nombre:</label>
                            <input type="text" id="editar-nombre-{{ juego.id }}" name="nombre" value="{{ juego.nombre }}" required class="minecraft-input">
                        </div>
                        
                        <div class="form-group">
                            <label for="editar-genero-{{ juego.id }}">G√©nero:</label>
                            <input type="text" id="editar-genero-{{ juego.id }}" name="genero" value="{{ juego.genero }}" required class="minecraft-input">
                        </div>
                        
                        <div class="form-group">
                            <label for="editar-a√±o-{{ juego.id }}">A√±o:</label>
                            <input type="number" id="editar-a√±o-{{ juego.id }}" name="a√±o" value="{{ juego.a√±o }}" class="minecraft-input">
                        </div>
                        
                        <div class="form-group">
                            <label for="editar-desarrollador-{{ juego.id }}">Desarrollador:</label>
                            <input type="text" id="editar-desarrollador-{{ juego.id }}" name="desarrollador" value="{{ juego.desarrollador }}" required class="minecraft-input">
                        </div>
                        
                        <div class="form-group">
                            <label>Consolas compatibles:</label>
                            <select id="editar-consolas-{{ juego.id }}" multiple class="select-dropdown">
                                {% for consola in consolas %}
                                <option value="{{ consola.id }}" 
                                    {% if consola.id in juego.consolas|map(attribute='id') %}selected{% endif %}>
                                    {{ consola.nombre }} ({{ consola.fabricante }})
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Accesorios compatibles:</label>
                            <select id="editar-accesorios-{{ juego.id }}" multiple class="select-dropdown">
                                {% for accesorio in accesorios %}
                                <option value="{{ accesorio.id }}"
                                    {% if accesorio.id in juego.accesorios|map(attribute='id') %}selected{% endif %}>
                                    {{ accesorio.nombre }} ({{ accesorio.tipo }})
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="editar-imagen-{{ juego.id }}">Imagen (dejar vac√≠o para no cambiar):</label>
                            <input type="file" id="editar-imagen-{{ juego.id }}" name="imagen" accept="image/*" class="minecraft-input">
                        </div>
                        
                        <button type="submit" class="minecraft-button">üíæ Guardar Cambios</button>
                        <button type="button" onclick="ocultarEditarJuego({{ juego.id }})" class="minecraft-button">‚ùå Cancelar</button>
                    </form>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Secci√≥n de Consolas -->
        <div id="consolas-section" class="minecraft-section" style="display:none;">
            <h2>üéÆ A√±adir Nueva Consola:</h2>
            <form id="consola-form" class="minecraft-form" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="nombre-consola">Nombre:</label>
                    <input type="text" id="nombre-consola" name="nombre" required class="minecraft-input">
                </div>
                
                <div class="form-group">
                    <label for="fabricante-consola">Fabricante:</label>
                    <input type="text" id="fabricante-consola" name="fabricante" required class="minecraft-input">
                </div>
                
                <div class="form-group">
                    <label for="a√±o-consola">A√±o de lanzamiento:</label>
                    <input type="number" id="a√±o-consola" name="a√±o_lanzamiento" class="minecraft-input">
                </div>
                
                <div class="form-group">
                    <label for="imagen-consola">Imagen:</label>
                    <input type="file" id="imagen-consola" name="imagen" accept="image/*" class="minecraft-input">
                </div>
                
                <button type="submit" class="minecraft-button">üïπÔ∏è Crear Consola</button>
            </form>

            <h2>üìú Tus Consolas:</h2>
            <div id="consolas-list">
                {% for consola in consolas %}
                <div class="minecraft-item" id="consola-{{ consola.id }}">
                    {% if consola.imagen %}
                    <img src="{{ consola.imagen }}" alt="{{ consola.nombre }}" class="minecraft-img">
                    {% endif %}
                    <div class="item-info">
                        <h3>{{ consola.nombre }}</h3>
                        <p><strong>Fabricante:</strong> {{ consola.fabricante }}</p>
                        {% if consola.a√±o_lanzamiento %}<p><strong>A√±o de lanzamiento:</strong> {{ consola.a√±o_lanzamiento }}</p>{% endif %}
                    </div>
                    <div class="item-actions">
                        <button onclick="mostrarEditarConsola({{ consola.id }})" class="minecraft-button">‚úèÔ∏è Editar</button>
                        <button onclick="eliminarConsola({{ consola.id }})" class="minecraft-button">üóëÔ∏è Eliminar</button>
                    </div>
                </div>

                <!-- Formulario de edici√≥n (oculto inicialmente) -->
                <div id="editar-consola-{{ consola.id }}" class="editar-form" style="display:none;">
                    <h3>‚úèÔ∏è Editar Consola</h3>
                    <form class="minecraft-form" onsubmit="actualizarConsola(event, {{ consola.id }})" enctype="multipart/form-data">
                        <input type="hidden" name="consola_id" value="{{ consola.id }}">
                        
                        <div class="form-group">
                            <label for="editar-nombre-consola-{{ consola.id }}">Nombre:</label>
                            <input type="text" id="editar-nombre-consola-{{ consola.id }}" name="nombre" value="{{ consola.nombre }}" required class="minecraft-input">
                        </div>
                        
                        <div class="form-group">
                            <label for="editar-fabricante-consola-{{ consola.id }}">Fabricante:</label>
                            <input type="text" id="editar-fabricante-consola-{{ consola.id }}" name="fabricante" value="{{ consola.fabricante }}" required class="minecraft-input">
                        </div>
                        
                        <div class="form-group">
                            <label for="editar-a√±o-consola-{{ consola.id }}">A√±o de lanzamiento:</label>
                            <input type="number" id="editar-a√±o-consola-{{ consola.id }}" name="a√±o_lanzamiento" value="{{ consola.a√±o_lanzamiento }}" class="minecraft-input">
                        </div>
                        
                        <div class="form-group">
                            <label for="editar-imagen-consola-{{ consola.id }}">Imagen (dejar vac√≠o para no cambiar):</label>
                            <input type="file" id="editar-imagen-consola-{{ consola.id }}" name="imagen" accept="image/*" class="minecraft-input">
                        </div>
                        
                        <button type="submit" class="minecraft-button">üíæ Guardar Cambios</button>
                        <button type="button" onclick="ocultarEditarConsola({{ consola.id }})" class="minecraft-button">‚ùå Cancelar</button>
                    </form>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Secci√≥n de Accesorios -->
        <div id="accesorios-section" class="minecraft-section" style="display:none;">
            <h2>üéß A√±adir Nuevo Accesorio:</h2>
            <form id="accesorio-form" class="minecraft-form" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="nombre-accesorio">Nombre:</label>
                    <input type="text" id="nombre-accesorio" name="nombre" required class="minecraft-input">
                </div>
                
                <div class="form-group">
                    <label for="tipo-accesorio">Tipo:</label>
                    <input type="text" id="tipo-accesorio" name="tipo" required class="minecraft-input">
                </div>
                
                <div class="form-group">
                    <label>Consolas compatibles:</label>
                    <select id="compatible-con-select" multiple class="select-dropdown">
                        {% for consola in consolas %}
                        <option value="{{ consola.id }}">{{ consola.nombre }} ({{ consola.fabricante }})</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="imagen-accesorio">Imagen:</label>
                    <input type="file" id="imagen-accesorio" name="imagen" accept="image/*" class="minecraft-input">
                </div>
                
                <button type="submit" class="minecraft-button">üéß Crear Accesorio</button>
            </form>

            <h2>üìú Tus Accesorios:</h2>
            <div id="accesorios-list">
                {% for accesorio in accesorios %}
                <div class="minecraft-item" id="accesorio-{{ accesorio.id }}">
                    {% if accesorio.imagen %}
                    <img src="{{ accesorio.imagen }}" alt="{{ accesorio.nombre }}" class="minecraft-img">
                    {% endif %}
                    <div class="item-info">
                        <h3>{{ accesorio.nombre }}</h3>
                        <p><strong>Tipo:</strong> {{ accesorio.tipo }}</p>
                        {% if accesorio.consolas_compatibles %}
                        <p><strong>Compatible con:</strong> 
                            {% for consola in accesorio.consolas_compatibles %}
                            <span class="compatibilidad-tag">{{ consola.nombre }}</span>
                            {% endfor %}
                        </p>
                        {% endif %}
                    </div>
                    <div class="item-actions">
                        <button onclick="mostrarEditarAccesorio({{ accesorio.id }})" class="minecraft-button">‚úèÔ∏è Editar</button>
                        <button onclick="eliminarAccesorio({{ accesorio.id }})" class="minecraft-button">üóëÔ∏è Eliminar</button>
                    </div>
                </div>

                <!-- Formulario de edici√≥n (oculto inicialmente) -->
                <div id="editar-accesorio-{{ accesorio.id }}" class="editar-form" style="display:none;">
                    <h3>‚úèÔ∏è Editar Accesorio</h3>
                    <form class="minecraft-form" onsubmit="actualizarAccesorio(event, {{ accesorio.id }})" enctype="multipart/form-data">
                        <input type="hidden" name="accesorio_id" value="{{ accesorio.id }}">
                        
                        <div class="form-group">
                            <label for="editar-nombre-accesorio-{{ accesorio.id }}">Nombre:</label>
                            <input type="text" id="editar-nombre-accesorio-{{ accesorio.id }}" name="nombre" value="{{ accesorio.nombre }}" required class="minecraft-input">
                        </div>
                        
                        <div class="form-group">
                            <label for="editar-tipo-accesorio-{{ accesorio.id }}">Tipo:</label>
                            <input type="text" id="editar-tipo-accesorio-{{ accesorio.id }}" name="tipo" value="{{ accesorio.tipo }}" required class="minecraft-input">
                        </div>
                        
                        <div class="form-group">
                            <label>Consolas compatibles:</label>
                            <select id="editar-compatible-con-{{ accesorio.id }}" multiple class="select-dropdown">
                                {% for consola in consolas %}
                                <option value="{{ consola.id }}"
                                    {% if consola.id in accesorio.consolas_compatibles|map(attribute='id') %}selected{% endif %}>
                                    {{ consola.nombre }} ({{ consola.fabricante }})
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="editar-imagen-accesorio-{{ accesorio.id }}">Imagen (dejar vac√≠o para no cambiar):</label>
                            <input type="file" id="editar-imagen-accesorio-{{ accesorio.id }}" name="imagen" accept="image/*" class="minecraft-input">
                        </div>
                        
                        <button type="submit" class="minecraft-button">üíæ Guardar Cambios</button>
                        <button type="button" onclick="ocultarEditarAccesorio({{ accesorio.id }})" class="minecraft-button">‚ùå Cancelar</button>
                    </form>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Secci√≥n de B√∫squeda -->
        <div id="busqueda-section" class="minecraft-section">
            <h2>üîç Buscar en el Cat√°logo</h2>
            
            <div class="search-box">
                <input type="text" id="search-query" placeholder="Buscar por nombre, g√©nero, a√±o..." class="minecraft-input">
                <select id="search-type" class="minecraft-input">
                    <option value="todo">Todo</option>
                    <option value="juegos">Juegos</option>
                    <option value="consolas">Consolas</option>
                    <option value="accesorios">Accesorios</option>
                </select>
                <button onclick="buscarRapida()" class="minecraft-button">Buscar</button>
                <button onclick="verHistorial()" class="minecraft-button">üìú Ver Historial</button>
            </div>
            
            <div id="search-results" class="search-results">
                <!-- Los resultados se mostrar√°n aqu√≠ -->
            </div>
        </div>
    </div>

    <script>
        // Mostrar secci√≥n seleccionada
        function mostrarSeccion(seccion) {
            document.querySelectorAll('.minecraft-section').forEach(el => {
                el.style.display = 'none';
            });
            document.getElementById(`${seccion}-section`).style.display = 'block';
        }

        // Mostrar formulario de edici√≥n
        function mostrarEditarJuego(id) {
            document.getElementById(`juego-${id}`).style.display = 'none';
            document.getElementById(`editar-juego-${id}`).style.display = 'block';
        }

        // Ocultar formulario de edici√≥n
        function ocultarEditarJuego(id) {
            document.getElementById(`juego-${id}`).style.display = 'flex';
            document.getElementById(`editar-juego-${id}`).style.display = 'none';
        }

        function mostrarEditarConsola(id) {
            document.getElementById(`consola-${id}`).style.display = 'none';
            document.getElementById(`editar-consola-${id}`).style.display = 'block';
        }

        function ocultarEditarConsola(id) {
            document.getElementById(`consola-${id}`).style.display = 'flex';
            document.getElementById(`editar-consola-${id}`).style.display = 'none';
        }

        function mostrarEditarAccesorio(id) {
            document.getElementById(`accesorio-${id}`).style.display = 'none';
            document.getElementById(`editar-accesorio-${id}`).style.display = 'block';
        }

        function ocultarEditarAccesorio(id) {
            document.getElementById(`accesorio-${id}`).style.display = 'flex';
            document.getElementById(`editar-accesorio-${id}`).style.display = 'none';
        }

        // Ver historial
        function verHistorial() {
            const clave = prompt("Ingrese la clave para ver el historial:");
            if (clave === "0000") {
                window.location.href = `/historial?clave=${clave}`;
            } else if (clave !== null) {
                alert("Clave incorrecta");
            }
        }

        // Buscar
        async function buscarRapida() {
            const query = document.getElementById('search-query').value.trim();
            const tipo = document.getElementById('search-type').value;
            
            if (!query) {
                alert('Por favor ingresa un t√©rmino de b√∫squeda');
                return;
            }
            
            try {
                const response = await fetch(`/api/buscar?q=${encodeURIComponent(query)}&tipo=${tipo}`);
                const resultados = await response.json();
                
                mostrarResultados(resultados);
            } catch (error) {
                alert('Error al buscar: ' + error.message);
                console.error(error);
            }
        }

        // Mostrar resultados de b√∫squeda
        function mostrarResultados(resultados) {
            const container = document.getElementById('search-results');
            container.innerHTML = '';
            
            if (!resultados || Object.keys(resultados).length === 0) {
                container.innerHTML = '<p class="no-results">No se encontraron resultados</p>';
                return;
            }
            
            for (const [tipo, items] of Object.entries(resultados)) {
                if (!items || !Array.isArray(items) || items.length === 0) continue;
                
                const tipoNombre = tipo === 'juegos' ? 'Juegos' : 
                                 tipo === 'consolas' ? 'Consolas' : 'Accesorios';
                
                const section = document.createElement('div');
                section.className = 'result-section';
                section.innerHTML = `<h3>${tipoNombre}</h3>`;
                
                items.forEach(item => {
                    const itemElement = document.createElement('div');
                    itemElement.className = `search-result-item result-type-${tipo}`;
                    
                    let html = `<h4>${item.nombre}</h4>`;
                    
                    if (item.genero) html += `<p><strong>G√©nero:</strong> ${item.genero}</p>`;
                    if (item.a√±o || item.a√±o_lanzamiento) html += `<p><strong>A√±o:</strong> ${item.a√±o || item.a√±o_lanzamiento}</p>`;
                    if (item.desarrollador) html += `<p><strong>Desarrollador:</strong> ${item.desarrollador}</p>`;
                    if (item.fabricante) html += `<p><strong>Fabricante:</strong> ${item.fabricante}</p>`;
                    if (item.tipo) html += `<p><strong>Tipo:</strong> ${item.tipo}</p>`;
                    if (item.compatible_con) html += `<p><strong>Compatibilidad:</strong> ${item.compatible_con}</p>`;
                    
                    if (item.imagen) {
                        html += `<img src="${item.imagen}" alt="${item.nombre}" class="minecraft-img">`;
                    }
                    
                    itemElement.innerHTML = html;
                    section.appendChild(itemElement);
                });
                
                container.appendChild(section);
            }
        }

        // Crear juego
        async function crearJuego(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            // Obtener consolas y accesorios seleccionados
            const consolas = Array.from(document.getElementById('consolas-select').selectedOptions)
                                .map(option => parseInt(option.value));
            const accesorios = Array.from(document.getElementById('accesorios-select').selectedOptions)
                                .map(option => parseInt(option.value));
            
            // Agregar al FormData
            consolas.forEach(id => formData.append('consolas', id.toString()));
            accesorios.forEach(id => formData.append('accesorios', id.toString()));
            
            try {
                const response = await fetch('/api/juegos', {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    alert('Juego creado con √©xito!');
                    location.reload();
                } else {
                    const error = await response.json();
                    throw new Error(error.detail || 'Error desconocido');
                }
            } catch (error) {
                alert('Error al crear juego: ' + error.message);
            }
        }

        // Actualizar juego
        async function actualizarJuego(e, id) {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            // Obtener consolas y accesorios seleccionados
            const consolas = Array.from(document.getElementById(`editar-consolas-${id}`).selectedOptions)
                                .map(option => parseInt(option.value));
            const accesorios = Array.from(document.getElementById(`editar-accesorios-${id}`).selectedOptions)
                                .map(option => parseInt(option.value));
            
            // Agregar al FormData
            consolas.forEach(id => formData.append('consolas', id.toString()));
            accesorios.forEach(id => formData.append('accesorios', id.toString()));
            
            try {
                const response = await fetch(`/api/juegos/${id}`, {
                    method: 'PUT',
                    body: formData
                });
                
                if (response.ok) {
                    alert('Juego actualizado con √©xito!');
                    location.reload();
                } else {
                    const error = await response.json();
                    throw new Error(error.detail || 'Error desconocido');
                }
            } catch (error) {
                alert('Error al actualizar juego: ' + error.message);
            }
        }

        // Eliminar juego
        async function eliminarJuego(id) {
            if (!confirm('¬øEst√°s seguro de eliminar este juego?')) return;
            
            try {
                const response = await fetch(`/api/juegos/${id}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    alert('Juego eliminado con √©xito!');
                    location.reload();
                }
            } catch (error) {
                alert('Error al eliminar juego: ' + error.message);
            }
        }

        // Crear consola
        async function crearConsola(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            try {
                const response = await fetch('/api/consolas', {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    alert('Consola creada con √©xito!');
                    location.reload();
                } else {
                    const error = await response.json();
                    throw new Error(error.detail || 'Error desconocido');
                }
            } catch (error) {
                alert('Error al crear consola: ' + error.message);
            }
        }

        // Actualizar consola
        async function actualizarConsola(e, id) {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            try {
                const response = await fetch(`/api/consolas/${id}`, {
                    method: 'PUT',
                    body: formData
                });
                
                if (response.ok) {
                    alert('Consola actualizada con √©xito!');
                    location.reload();
                } else {
                    const error = await response.json();
                    throw new Error(error.detail || 'Error desconocido');
                }
            } catch (error) {
                alert('Error al actualizar consola: ' + error.message);
            }
        }

        // Eliminar consola
        async function eliminarConsola(id) {
            if (!confirm('¬øEst√°s seguro de eliminar esta consola?')) return;
            
            try {
                const response = await fetch(`/api/consolas/${id}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    alert('Consola eliminada con √©xito!');
                    location.reload();
                }
            } catch (error) {
                alert('Error al eliminar consola: ' + error.message);
            }
        }

        // Crear accesorio
        async function crearAccesorio(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            // Obtener consolas compatibles seleccionadas
            const consolas = Array.from(document.getElementById('compatible-con-select').selectedOptions)
                                .map(option => parseInt(option.value));
            
            // Agregar al FormData como string separado por comas
            formData.append('compatible_con', consolas.join(','));
            
            try {
                const response = await fetch('/api/accesorios', {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    alert('Accesorio creado con √©xito!');
                    location.reload();
                } else {
                    const error = await response.json();
                    throw new Error(error.detail || 'Error desconocido');
                }
            } catch (error) {
                alert('Error al crear accesorio: ' + error.message);
            }
        }

        // Actualizar accesorio
        async function actualizarAccesorio(e, id) {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            // Obtener consolas compatibles seleccionadas
            const consolas = Array.from(document.getElementById(`editar-compatible-con-${id}`).selectedOptions)
                                .map(option => parseInt(option.value));
            
            // Agregar al FormData como string separado por comas
            formData.append('compatible_con', consolas.join(','));
            
            try {
                const response = await fetch(`/api/accesorios/${id}`, {
                    method: 'PUT',
                    body: formData
                });
                
                if (response.ok) {
                    alert('Accesorio actualizado con √©xito!');
                    location.reload();
                } else {
                    const error = await response.json();
                    throw new Error(error.detail || 'Error desconocido');
                }
            } catch (error) {
                alert('Error al actualizar accesorio: ' + error.message);
            }
        }

        // Eliminar accesorio
        async function eliminarAccesorio(id) {
            if (!confirm('¬øEst√°s seguro de eliminar este accesorio?')) return;
            
            try {
                const response = await fetch(`/api/accesorios/${id}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    alert('Accesorio eliminado con √©xito!');
                    location.reload();
                }
            } catch (error) {
                alert('Error al eliminar accesorio: ' + error.message);
            }
        }

        // Configurar formularios al cargar
        document.addEventListener('DOMContentLoaded', () => {
            // Mostrar secci√≥n de b√∫squeda por defecto
            mostrarSeccion('busqueda');
            
            // Configurar b√∫squeda al presionar Enter
            document.getElementById('search-query').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') buscarRapida();
            });
            
            // Configurar formularios
            document.getElementById('juego-form').addEventListener('submit', crearJuego);
            document.getElementById('consola-form').addEventListener('submit', crearConsola);
            document.getElementById('accesorio-form').addEventListener('submit', crearAccesorio);
        });
    </script>
</body>
</html>